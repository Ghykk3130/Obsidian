# 1. 等熵面

考虑一个系统由几个不相互作用的子系统组成。互不作用的话子系统粒子数就是定值，不计入变量。子系统体积自然也不会变化，不计入变量。例如有两个子系统。那么我们有：
$$S(U_{1},U_{2})=S_{1}(U_{1})+S_{2}(U_{2})$$
我们可以构造这个系统的等熵面。令：
$$S(U_{1},U_{2})=\text{const.}$$
则在$U_{1},U_{2}$张成空间中，自动形成一个一维面。这是因为$U_{1},U_{2}$张成2维空间，而约束去掉一维。关于这个一维面，我们可以作什么结论？

首先，该曲线一定单调递减。因为：
$$\begin{align}
 & dS= \frac{\partial S}{\partial U_{1}}dU_{1}+ \frac{\partial S}{\partial U_{2}}dU_{2}=0 \\ \implies &  \frac{\partial S_{1}}{\partial U_{1}}dU_{1}+ \frac{\partial S_{2}}{\partial U_{2}}dU_{2}=0 \\
\implies & \frac{1}{T_{1}}dU_{1}+ \frac{1}{T_{2}}dU_{2}=0\\

\implies &  \left(  \frac{\partial U_{2}}{\partial U_{1}} \right)_{S} =- \frac{T_{2}}{T_{1}}<0 
\end{align}$$
其次，该曲线一定上凹。因为：
$$\begin{align}
\frac{\partial^{2}U_{2}}{\partial U_{1}^{2}} & = - \frac{\partial}{\partial U_{1}}\left(  \frac{T_{2}}{T_{1}} \right) \\
 & = \frac{- \frac{\partial}{\partial U_{2}}\left(  \frac{1}{T_{2}} \right) \frac{1}{T_{1}}+ \frac{\partial}{\partial U_{2}}\left(  \frac{1}{T_{1}} \right) \frac{1}{T_{2}}}{T_{1}^{2}} \\
 & = \frac{- \frac{\partial}{\partial U_{2}}\left(  \frac{1}{T_{2}} \right) \frac{1}{T_{1}}}{T_{1}^{2}}
\end{align}$$
这是因为$T_{1}$不具有$U_{2}$的dependence。
而：
$$\begin{align}
\text{numerator} & = \frac{1}{T_{2}^{2}} \frac{\partial T_{2}}{\partial U_{2}} \frac{1}{T_{1}} \\
 & = \frac{1}{T_{2}^{2}T_{1}} \frac{1}{C_{2}} >0 
\end{align}$$
因此，一维等熵面在子系统能量张成空间中长这样：
<div style="text-align:center">
<img src="055311113a5784900872efd078cb5615.jpg" width="300">
</div>
而我们知道：
$$\nabla S= \frac{\partial S}{\partial U_{1}} \hat{U}_{1}+ \frac{\partial S}{\partial U_{2}} \hat{ U}_{2}= \frac{\partial S_{1}}{\partial U_{1}} \hat{U}_{1}+ \frac{\partial S_{2}}{\partial U_{2}} \hat{U}_{2}= \frac{\hat{U}_{1}}{T_{1}}+ \frac{\hat{U}_{2}}{T_{2}}$$
所以，越朝着右上方走，等上面代表的熵越大。

我们可以推广到高维。例如三维。考虑由三个互不作用的子系统构成的系统。我们想知道曲面$S(U_{1},U_{2},U_{3})= S_{1}(U_{1})+S_{2}(U_{2})+S_{3}(U_{3})$长什么样。

我们fix $U_{2}$和$S$。考虑：
$$\begin{align}
dS &= \frac{\partial S}{\partial U_{1}}dU_{1}+ \frac{\partial S}{\partial U_{3}} dU_{3} \\
 & = \frac{1}{T_{1}}dU_{1}+ \frac{1}{T_{3}}dU_{3}=0
\end{align}$$
于是同样：
$$\frac{\partial U_{3}}{\partial U_{1}}= - \frac{T_{3}}{T_{1}}<0$$
这对于每一对坐标都是一样的。我们继续考虑：
$$\begin{align}
\frac{\partial^{2}U_{3}}{\partial U_{1}^{2}} & = -\frac{\partial}{\partial U_{1}}\left(  \frac{T_{3}}{T_{1}} \right) \\
 & = -\frac{\frac{\partial}{\partial U_{1}}(T_{3})T_{1}- \frac{\partial}{\partial U_{1}}(T_{1})T_{3}}{T_{1}^{2}} \\
 & = \frac{ \frac{\partial}{\partial U_{1}}(T_{1})T_{3}}{T_{1}^{2}} \\
 & = \frac{ \frac{T_{3}}{C_{1}}}{T_{1}^{2}}>0
\end{align}$$
所以曲面在每个$U_{1},U_{3}$张成横截面上都是一个上凹单减曲线。这对于每对坐标都一样。所以曲面长这样：
<div style="text-align:center">
<img src="d38e6728541e51191977e6f796e20518.jpg" width="300">
</div>
同样地，我们有：
$$\nabla S= \frac{\partial S}{\partial U_{1}}\hat{U}_{1}+ \frac{\partial S}{\partial U_{2}}\hat{U}_{2}+ \frac{\partial S}{\partial U_{3}}\hat{U}_{3}= \frac{\hat{U}_{1}}{T_{1}}+ \frac{\hat{U}_{2}}{T_{2}}+ \frac{\hat{U}_{3}}{T_{3}}$$
所以往第一象限深处走，等熵面的熵会增加。

我们可以将上述结果进一步generalize。若系统允许相互机械作用，则体积可以被相互间的压强改变。那么对于两个子系统构成的系统，我们有：
$$S(U_{1},U_{2},V_{1},V_{2})=S(U_{1},V_{1})+S(U_{2},V_{2})$$
我们发现，在$V_{1},V_{2}$张成平面中：
$$\begin{align}
dS & = \frac{\partial S}{\partial V_{1}}dV_{1}+ \frac{\partial S}{\partial V_{2}}dV_{2} \\
 & = - \frac{\partial U_{1} / \partial V_{1}}{\partial U_{1} / \partial S_{1}}dV_{1}- \frac{\partial U_{2} / \partial V_{2}}{\partial U_{2} / \partial S_{2} }dV_{2} \\
 & = \frac{p_{1}}{C_{1}}dV_{1}+ \frac{p_{2}}{C_{2}}dV_{2} \\
\implies &  \frac{\partial V_{2}}{\partial V_{1}}= -\frac{p_{1}C_{2}}{p_{2}C_{1}}<0
\end{align}$$
所以等熵面投影也是单减。进一步地：

# 2. 熵最大原理

任意一个均一的系统的内能可以这样描述：
$$U=U(S,x)$$
那么我们可以解出$S$：
$$S=S(U,x)$$
这是一个系统的态方程。现在考虑一个由多个子系统构成的封闭系统。每个子系统i具有$S_{i},U_{i},x_{i}$。其中$S_{i}=S_{i}(U_{i},x_{i})$。对于这个系统，我们有：
$$S=S(S_{1},\dots, x_{1},\dots, U_{1},\dots)$$
## Ex:
在子系统不相互作用的情况下，总熵只是每个子系统熵的代数和。即：
$$S=\sum_{i}S_{i}$$
而$S$也可能不是子系统$S_{i}$直接相加，而是存在一定相互作用，并且每个子系统的除熵之外的变量也因为相互作用couple进了$S$中。因此最一般的情形可以写为$S=S(S_{1},\dots,x_{1},\dots,U_{1},\dots)$


而因为$S_{i}=S_{i}(U_{i},x_{i})$，进而我们可以写：
$$S=S(U_{1},\dots,x_{1},\dots)$$
或者直接简写为$S=S(U,x)$。这可以看作一个流形上的函数，即一个surface。这个surface的含义是：

**在系统平衡时，给定$U,x$，我们可以计算系统的$S$。系统的熵处在一个surface上。**

一般来说，系统不能处在整个surface上。例如我可以约束某个特定的work variable：$x_{i}=\text{const.}$。物理上这可以表现为，两个箱气体互相接触，我规定其中某箱气体体积恒定，装在刚性容器中。在没有施加其他约束的情况下，系统仍然可以去往任何符合约束的位置。例如我没有约束另一箱气体的体积，那么那箱气体可以任意膨胀，收缩。

每添加一个约束，$S$就会减少一维。每减少一个约束，$S$就会增加一维。考虑在某套约束下的封闭系统处于平衡态。我们考虑如下问题：

**去掉某个约束后，系统最终在哪个位置平衡？**

去掉某个约束后，系统一般移动到一个新的平衡位置。新的平衡位置一定还在$S(U,x)$上，因为这是系统的态方程。但是中间的移动过程是未知的（有可能甚至没有well-defined的路径）。

由[[熵^theorem12|proposition 1.2]]可知，$\Delta S\geq 0$。所以系统一定移动到了surface上更高的一点。但是更高的点有很多。我们必须假设系统处在新的约束下熵最大的一点：

>[! Postulate 1]
>The thermal equilibrium of an isolated system is achieved when $(\delta S)_{U}=0,(\delta^{2}S)_{U}<0$ under the given constraint.
^postulate1
## Remark
我们可以更严格的陈述。对于复合封闭系统，我们一般有：
$$U=U(S,x)\implies S=S(U,x)$$
其中，$U$是子系统能量的集合，$x$是子系统广义功变量的集合。在某套约束下，这些变量被进一步消减。注意，封闭系统的$dU=0$也是一个约束。我们只把$S$写为消减后的独立变量的函数。

记$(\eta_{1},\dots)=\eta=(U_{1},\dots,x_{1},\dots)=(U,x)$为全体独立的extensive variables。于是系统从平衡位置稍微displace一下，就有：
$$\begin{align}
S(\eta_{1}+\delta \eta_{1},\dots)=S(\eta_{1},\dots)+ \frac{\partial S}{\partial \eta_{i}}\delta \eta_{i}+ \frac{\partial^{2}S}{\partial \eta_{i}\eta_{j}}\delta \eta_{i}\delta \eta_{j}+\dots 
\end{align}$$
定义:
$$\begin{align}
 & \delta S= \frac{\partial S}{\partial \eta_{i}}\delta \eta_{i} \\
 & \delta^{2}S= \frac{\partial^{2}S}{\partial \eta_{i}\partial\eta_{j}}\delta \eta_{i}\delta \eta_{j}
\end{align}$$
$\delta^{2}S$可以看作一个二次型。则由postulate 1：
$$\begin{align}
 & \frac{\partial S}{\partial \eta_{i}}\delta\eta_{i}=0,\forall \delta \eta_{i}\implies \frac{\partial S}{\partial \eta_{i}}=0 \\
 & \frac{\partial^{2} S}{\partial \eta_{i}\partial\eta_{j}}\delta \eta_{i}\delta \eta_{j}<0,\forall \delta \eta_{i},\delta \eta_{j}\implies \text{the matrix } \frac{\partial^{2}S}{\delta \eta_{i}\delta \eta_{j}}\text{ is negative definite}
\end{align}$$
## Ex:
我们来看矩阵$\left( \frac{\partial^{2}S}{\partial \eta_{i}\partial \eta_{j}} \right)=(\nabla \otimes \nabla)S$长什么样。

我们知道：
$$\begin{align}
 & \frac{\partial^{2}S}{\partial U_{i}\partial U_{j}}= \frac{\partial}{\partial U_{i}}\left( \frac{\partial S_{j}}{\partial U_{j}} \right)=0,\text{if }i\neq j \\
 & \frac{\partial^{2}S}{\partial U_{i}\partial V_{j}}= \frac{\partial}{\partial U_{i}}\left(  \frac{\partial S_{j}}{\partial V_{j}} \right)=0,\text{ if }i\neq j \\
 & \frac{\partial^{2}S}{\partial V_{i}\partial V_{j} }= \frac{\partial}{\partial V_{i}}\left(  \frac{\partial S_{j}}{\partial V_{j}} \right)=0,\text{ if }i\neq j
\end{align}$$
这是因为$\frac{\partial S_{j}}{\partial U_{j}}$是$U_{j},V_{j}$的函数，对其求导$\frac{\partial}{\partial U_{i}}\left( \frac{\partial S_{j}}{\partial U_{j}} \right)$自然为零。所以，若写为矩阵可以写作如下分块阵：
$$\begin{pmatrix}
\left( \frac{\partial^{2}S}{\partial U_{i}\partial U_{j}} \right) & \left(  \frac{\partial^{2}S}{\partial U_{i}\partial V_{j}} \right) \\
\left( \frac{\partial^{2}S}{\partial V_{i}\partial U_{j}} \right) & \left(  \frac{\partial^{2}S}{\partial V_{i}\partial V_{j}} \right)
\end{pmatrix}$$
每个块经过上面的讨论都是对角阵。

## Ex:
考虑一个由三个子系统构成的系统的平衡。我们约束：
$$U_{1}+U_{2}+U_{3}=U$$
这构成一个由normal vector $\begin{pmatrix}1 & 1 & 1\end{pmatrix}^t$表示的平面。则在平面上任意一点，只要不和等熵面相切，则这个点对应的等熵面就不是最大的熵。这是因为我们总可以将等熵面往外移获得更大的熵，知道等熵面和平面相切为止。
<div style="text-align:center">
<img src="9885955810bb48f6a28c69f7f533656a.jpg" width="300">
</div>
# 3. 熵最大原理的一个例子

我们不妨设存在一个系统，其熵为如下形式：
$$S(U_{1},U_{2})= -U_{1}^{2}-U_{1}U_{2}- U_{2}^{2}$$
然后存在一个能量约束：
$$U_{1}+U_{2}=1$$
则一阶变动为：
$$\begin{align}
\delta S & = \frac{\partial S}{\partial U_{1}}\delta U_{1}+ \frac{\partial S}{\partial U_{2}}\delta U_{2} \\
 & = -(2U_{1}+U_{2})\delta U_{1}-(2U_{2}+U_{1})\delta U_{2}
\end{align}$$
无穷小约束为：
$$\delta U_{1}+\delta U_{2}=0$$
带入得到：
$$U_{1}=U_{2}$$
我们计算Hessian矩阵：
$$\begin{pmatrix}
\partial^{2} S / \partial U_{1}^{2} & \partial^{2} S / \partial U_{1}\partial U_{2} \\
\partial^{2}S / \partial U_{1} \partial U_{2} &  \partial^{2}S / \partial U_{2}^{2}
\end{pmatrix}=\begin{pmatrix}
-2 & -1 \\
-1 & -2
\end{pmatrix}$$
计算特征值得到$\lambda=-1,-3<0$于是Hessian矩阵负定。于是在平衡点二阶变动为：
$$\begin{pmatrix}
\delta U_{1} & \delta U_{2} 
\end{pmatrix}\begin{pmatrix}
-2 & -1 \\
-1 & -2
\end{pmatrix}\begin{pmatrix}
\delta U_{1} \\
\delta U_{2}
\end{pmatrix}<0,\forall\delta U_{1},\delta U_{2}$$
注意这不是熵最大原理。因为熵最大原理说的不是Hessian矩阵在全空间负定。而是Hessian矩阵在约束总能量恒定的子空间负定。也就是熵最大原理只要求在带入$\delta U_{1}=-\delta U_{2}$时上式负定。所以我们这个例子给出的条件更强。

我们可以看到，如果再进一步添加约束，且老平衡点符合新约束，那么由于在老平衡点已经在约束能量时二次型负定，而进一步约束又只能约束到更小的子空间上，所以二次型还是负定。

但是如果新添加的约束不包含老平衡点，必须重新找到熵局部极大的新平衡点。在新平衡点，新的Hessian矩阵还是负定。

因此无论引入的约束是否移动平衡点，在平衡点的Hessian矩阵都是负定的。

# 4. 能量最小原理
## 4.1 简单系统

考虑这样一个系统的平衡：
$$U(S_{1},S_{2},V_{1},V_{2})=U_{1}(S_{1},V_{1})+U_{2}(S_{2},V_{2})$$
先不考虑任何约束，则：
$$\delta U= \frac{\partial U_{1}}{\partial S_{1}}\delta S_{1}+ \frac{\partial U_{2}}{\partial S_{2}}\delta S_{2}+ \frac{\partial U_{1}}{\partial V_{1}}\delta V_{1}+ \frac{\partial U_{2}}{\partial V_{2}}\delta V_{2}$$
若我们约束总熵恒定，则：
$$\delta U= \left(  \frac{\partial U_{1}}{\partial S_{1}}- \frac{\partial U_{2}}{\partial S_{2}} \right)\delta S_{1}+ \frac{\partial U_{1}}{\partial V_{1}}\delta V_{1}+ \frac{\partial U_{2}}{\partial V_{2}}\delta V_{2}$$
若我们约束系统封闭，我们有：
$$\begin{align}
\delta S & = \frac{\partial S_{1}}{\partial U_{1}}\delta U_{1}+ \frac{\partial S_{2}}{\partial U_{2}}\delta U_{2}+ \frac{\partial S_{1}}{\partial V_{1}}\delta V_{1}+ \frac{\partial S_{2}}{\partial V_{2}}\delta V_{2} \\
 & = \left( \frac{\partial S_{1}}{\partial U_{1}}- \frac{\partial S_{2}}{\partial U_{2}} \right)\delta U_{1}+ \frac{\partial S_{1}}{\partial V_{1}}\delta V_{1}+ \frac{\partial S_{2}}{\partial V_{2}}\delta V_{2}
\end{align}$$
由熵最大原理，封闭系统的平衡点必有：
$$\begin{align}
 & \frac{\partial S_{1}}{\partial U_{1}}- \frac{\partial S_{2}}{\partial U_{2}}=0 \\
 & \frac{\partial S_{1}}{\partial V_{1}}\delta V_{1}+ \frac{\partial S_{2}}{\partial V_{2}}\delta V_{2}=0
\end{align}\ \dots *)$$
第二个式子不脱去$\delta$是因为我们没有明确$V_{1},V_{2}$之间是否有约束。而且不脱去不影响下面推导。又：
$$\begin{align}
 & \frac{\partial S_{1}}{\partial V_{1}}= - \frac{\partial U_{1} / \partial V_{1}}{\partial U_{1} / \partial S_{1}} \\
 & \frac{\partial S_{2}}{\partial V_{2}}= - \frac{\partial U_{2} / \partial V_{2}}{\partial U_{2} / \partial S_{2}}
\end{align}$$
而且$\frac{\partial U_{1}}{\partial S_{1}} = \frac{\partial U_{2}}{\partial S_{2}}$。所以：
$$\frac{\partial S_{1}}{\partial V_{1}}\delta V_{1}+ \frac{\partial S_{2}}{\partial V_{2}}\delta V_{2}= - \frac{1}{\partial U_{1} / \partial S_{1}}\left(  \frac{\partial U_{1}}{\partial V_{1}}\delta V_{1}+ \frac{\partial U_{2}}{\partial V_{2}}\delta V_{2} \right)=0$$
$$\implies \frac{\partial U_{1}}{\partial V_{1}}\delta V_{1}+ \frac{\partial U_{2}}{\partial V_{2}}\delta V_{2}=0$$

若假设系统封闭时的平衡点和系统总熵恒定时的平衡点一样，显然将上面的这些式子代入$\delta U$表达式中得到：
$$\delta U=0$$


>[!Note] Proposition 1
>At equilibrium,
>- For system with constant $S,V$, $U$ is minimized
>- For system with constant $T,V$, $F$ is minimized
>- For system with constant $S,p$, $G$ is minimized


$$\left( \frac{\partial U}{\partial V} \right)_{S}= - \frac{(\partial S / \partial V)_{U}}{( \partial S / \partial U)_{V}}$$

既然平衡时总熵取到某种极值，那么总能量会不会也取到某个极值，从而与最大熵原理构成等价命题？

在没有约束时，熵为：
$$S=S(S_{1},\dots)$$
而其中：
$$S_{i}=S_{i}(U_{i},x_{i})$$
而我们一定可以反解出：
$$U_{i}=U_{i}(S_{i},x_{i})$$
而总能量的最一般形式为：
$$U=U(U_{1},\dots,S_{1},\dots,x_{1},\dots)$$
## Ex:
在子系统不相互作用时，总能量为子系统能量的代数和。即：
$$U=\sum_{i}S_{i}$$
而写成$U=U(U_{1},\dots,S_{1},\dots,x_{1},\dots)$只是因为最一般的情况下，子系统间可能存在相互作用，导致$S_{i},x_{i}$ couple进$U$中。

那么因为$U_{i}=U_{i}(S_{i},x_{i})$，我们可以进一步写为：
$$U=U(S_{1},\dots,x_{1},\dots)$$

我们进一步考虑系统存在某种约束。假设带入约束化简后，系统的变量进一步减少。最终我们有：
$$U=U(S_{1},\dots,x_{1},\dots)$$
虽然看起来和上面没区别，但这里的$S_{i},x_{i}$都是消减约束后的独立变量。

对于广义功变量$x_{1}$我们想estimate $\left( \frac{\partial U}{\partial x_{1}} \right)_{S}$。其中implicit地，处$x_{1}$外所有功变量，所有的熵都hold constant。

因为$S=S(U_{1},\dots,x_{1},\dots)$，我们可以强行将$U$带入进变量。比如说消去第二个变量$U_{2}=U-U_{1}-\dots$。那么对$S$微分就有：
$$dS= \frac{\partial S}{\partial U_{1}}dU_{1}+ \frac{\partial S}{\partial U}dU+\dots + \frac{\partial S}{\partial x_{1}}dx_{1}+\dots=0$$
因为在$\left( \frac{\partial U}{\partial x_{1}} \right)_{S}$中，我们要求除了$x_{1}$以外的所有功变量都为常量，且所有的熵都为常量。所以在上述微分中，令$dx=0,j\neq 1$。并且，因为所有的熵都为常量，所以$S_{j},j\neq 1$为常量。而$x_{j},j\neq 1$也为常量。因此$U_{j}=U_{j}(S_{j},x_{j}),j\neq 1$都为常量。所以上式变为：
$$dS= \frac{\partial S}{\partial U}dU+ \frac{\partial S}{\partial x_{1}}dx_{1}=0$$
于是：
$$\left( \frac{\partial U}{\partial x_{1}} \right)_{S}= - \frac{(\partial S / \partial x_{1})_{U}}{(\partial S / \partial U)_{x_{1}}}$$
其中，implicit地，分子除$x_{1}$外所有的功变量，所有的能量全部hold constant。那么这正是系统封闭，在约束除$x_{1}$外所有功变量的平衡。那么分子比为零。因此：
$$\left( \frac{\partial U}{\partial x_{1}} \right)_{S}=0$$
# 5. Other formulations

考虑一个系统被约束在恒定温度曲面上。不妨考虑一个heat reservoir来维持恒温。令总系统的总熵被约束为常量。则总系统须满足：
$$\begin{align}
 & \delta^{}U_{tot}=\delta^{}(U+U_{r})=0 \\
 & \delta^{2}U_{tot}=\delta^{2}(U+U_{r})>0
\end{align}$$
于是：
$$\begin{align}
\delta(U+U_{r})=0 & \implies\delta U+\delta U_{r}=\delta U+T_{r}\delta S_{r}=\delta U+T(-\delta S)=\delta(U-TS )=0
\end{align}$$
上面用到了$T$为常数，还有约束$\delta S_{r}+\delta S=0$。于是：
$$\delta F=0$$
我们不妨用$T,V,T_{r}$来描述总系统。于是：
$$\begin{align}
\delta^{2} U_{r} & =\frac{\partial^{2}U_{r}}{\partial T_{r}^{2}}\delta^{2}T_{r}
\end{align}$$
然而，为了维持恒定温度，heat reservoir必须无限大。而$\frac{\partial^{2}U_{r}}{\partial T_{r}^{2}}$分子是一个extensive variable，分母是两个extensive variable。则整体在极限下为零。所以：
$$\begin{align}
\delta^{2}(U+U_{r}) & =\delta^{2}U \\
 & =\delta^{2}(U-TS) \\
  & =\delta^{2}F>0
\end{align}$$
这是因为$TS$中$T$维持恒定，不会被微分。而$S$

>[!Theorem]
>- If the temperature is constant, then $F$ is minimized.
>- If the pressure is constant, then $H$ is minimized.
>- If both the temperature and the pressure are constant, then $G$ is minimized.

# 6.   Handwave

考虑一个系统存在约束$\delta T=0$，那么
# 2. 正则系综

## 1. 推导1

考虑一个系统具有确定的$N,V, T$。因为我们没有限制$E=\text{const.}$，所以系统不能直接用微正则系综计算。我们试图计算系统处在某一微观态的概率$\rho$。

将系统extend为一个heat reservoir加原系统的封闭系统。设系统处于该微观态具有能量$E_{S}$。假设系统和reservoir弱相互作用。则reservoir能量为：
$$E-E_{s}$$
整个系统可用微正则系综计算。一对特定的系统和reservoir的态都具有相同概率。但是此处我们选定了系统某个特定的态，但是reservoir却可以有很多态符合$E-E_{s}$。具体的态数为$\Omega_{r}(E-E_{s})$。因为这每个态在微正则系综中都具有相同的权重，那么显然：
$$\rho \propto \Omega_{r}(E-E_{s})$$
我们知道：
$$\begin{align}
 & \ln(\Omega_{r}(E-E_{s}))  = \ln(\Omega_{r}(E))- \frac{\partial}{\partial E_{r}}(\ln \Omega_{r}(E_{r})) E_{s} \\
 & \text{Set }\beta:  = \frac{\partial}{\partial E_{r}}(\ln \Omega_{r}(E_{r}))= \frac{1}{kT_{}}\implies \Omega_{r}(E-E_{r})= \text{const.} \exp(-\beta E_{s})
\end{align}$$
>[!Caveat]
>此处不能直接对$\Omega_{r}$展开。因为$S_{r}$是extensive的，按照$N$增长。从而$\Omega_{r}\sim\exp S_{r}$是按照$\exp(N)$增长的。所以直接用$\Omega_{r}$展开会导致误差。

所以：
$$\rho \propto \exp(-\beta E_{s})$$
After normalization：
$$\rho= \frac{\exp(-\beta E_{s})}{Z}$$

连续化：
$$\rho(q,p)d^{}qd^{}p= \frac{dqdp}{N!h^{3N}} \frac{\exp(-\beta E_{s})}{Z}$$
连续化的思路为：我问相空间内某点附近$dqdp$范围内，观测到系统的概率是多少。我先用$\frac{dqdp}{N!h^{3N}}$计算这个体元内有多少态。而落在这些态的概率都是$\frac{\exp(-\beta E_{s})}{Z}$。

## Remark
我们发现，在微正则系综下，内能不存在fluctuation。因为它本身必须被约束为常量。但是在正则系综中，内能存在fluctuatiaon。这是因为每一个能量本征态都是accessible的，只是概率不同。

## 2. 推导2

考虑一个系统具有本征能量谱$\{ E_{j} \}$。我们想知道在某一温度$T$下，系统处于能量本征态$E_{j}$的概率$P_{j}$。

>[!Caveat]
>系统处在某个本征态$E_{j}$的概率和系统具有能量$E_{j}$的概率是不同的。若$E_{j}$对应的能级是2-fold degenerate的，那么系统处在某个本征态$E_{j}$的概率指，系统处于这两个态其一的概率。而系统具有能量$E_{j}$的概率为系统处于这两个态的概率之和。


为此，我们想象一个由大量相同系统组成的系综。系综内子系统相互作用弱。我们认为，当系综中的系统数$M$越大时，其中处于能量本征态$E_{j}$系统的数量的占比就越趋近于$p_{j}$。当$M\rightarrow \infty$时，就可以严格等于。

为了方便计算，我们将整个系综想象成一个巨大的封闭系统。这是因为我们知道封闭系统的每个non-degenerate的态都是等概率的。（尽管这么做让人觉得不安，但没有任何东西阻止我们这么做。）

令$n_{j}:=\text{ number of systems in state }E_{j}$。那么对于某个sequence $\{ n_{j} \}$，整个系综符合这个sequence的态数为：
$$W(\{ n_{j} \})= \frac{M!}{n_{1}!n_{2}!\dots}$$
其中，存在约束：
$$\begin{align}
 & \sum_{j}n_{j}=M \\
 & \sum_{j}n_{j}E_{j}=E
\end{align}$$
我们知道，$W(\{ n_{j} \})$在$\{ n_{j} \}$张成的空间中大概是peaked的。于是在取$M\rightarrow \infty$时，就就只会分布在peak这点。于是我们算一下peak。因为$\ln$近似之后更好算，我们算$\ln W$的peak。考虑Lagrange乘子。我们有：
$$\begin{align}
\ln\left(  \frac{M!}{n_{1}!n_{2}!}\dots \right)  -\alpha \sum n_{j}- \beta \sum_{} n_{j}E_{j}  & \approx M\ln M-\sum n_{j}\ln n_{j}-\alpha \sum n_{j}-\beta \sum n_{j}E_{j} 
\end{align}$$
我们maximize得到：
$$n_{j}=e^{-1-\alpha}e^{-\beta E_{j}}=Ae^{-\beta E_{j}},\text{ for some constant }A$$
显然由于约束，我们有：
$$\sum n_{j}=M\implies A= \frac{M}{Z}$$
我们令$p_{j}= \frac{e^{-\beta E_{j}}}{Z}$。于是便有：
$$\begin{align}
\ln(W) & \approx M\ln M-\sum n_{j}\ln n_{j} \\
 & = -M\sum p_{j}\ln p_{j}
\end{align}$$
为了约束温度，我们计算整个系综的熵：
$$S=-kM\sum p_{j}\ln p_{j}$$
则：
$$T= (\frac{\partial S}{\partial E})^{-1}$$
而为了将$S$写为$E$的函数，我们有：
$$\sum n_{j}E_{j}=E \implies - M \frac{\partial}{\partial \beta}\ln Z=E \tag{*}$$
于是：
$$\begin{align}
S & = -kM\sum \frac{e^{-\beta E_{j}}}{Z}\ln\left(  \frac{e^{-\beta E_{j}}}{Z} \right)  \\
 & = -kM\left( \beta \frac{\partial}{\partial \beta}\ln Z-\ln Z \right) \\
 & = -kM\left( - \beta \frac{E}{M}-\ln Z \right)
\end{align}$$
>[!Caveat ]
>我们发现$Z=\sum e^{-\beta E_{j}}$是$\beta$的函数。它不是$E_{j}$的函数，因为此处$E_{j}$为能量谱，为常数。

注意到$S=S(E,\beta)$。于是求导得到：
$$\begin{align}
  \frac{\partial S}{\partial E} & = k\beta= \frac{1}{T}
\end{align}\implies \beta= \frac{1}{kT}$$
于是只要我们强行约束$T$为我们想求的系统的$T$，再取热力学极限后我们就得到了$p_{j}$。

>[!Note] Proposition 1
>$U=- \frac{\partial}{\partial \beta}Z,F=- \frac{1}{\beta}\ln Z$
## Proof.
$$U= \frac{\sum He^{-\beta H}}{\sum e^{-\beta H}}= - \frac{\partial}{\partial \beta} \ln Z$$
然后容易凑出$F$。回忆起：
$$\begin{align}
F & =U-TS \\
 \implies U & =F+TS \\
 & =F- T \frac{\partial F}{\partial T} \\
 & =F+ \beta \frac{\partial F}{\partial \beta} \\
 & = \frac{\partial}{\partial \beta}(\beta F)
\end{align}$$
于是只需令$\beta F=-\ln Z$即可令等式成立。若假设热力学势模掉常数是唯一的，则如此构造出来的$F$可以作为自由能。
>[!Right]
>$\blacksquare$



